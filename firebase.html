<!DOCTYPE html>
<html>
<head>
<title>firebase.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="firebase">Firebase</h1>
<h2 id="deep-linking">Deep linking</h2>
<h3 id="android">Android</h3>
<ol>
<li>
<p>Agregue los siguientes metadados dentro de la etiqueta <em>activity</em> en <em>android/app/src/main/AndroidManifest.xml</em>. Modfique el :host=&quot;su_dominio.com&quot;</p>
<pre class="hljs"><code><div><span class="hljs-tag">&lt;<span class="hljs-name">meta-data</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"flutter_deeplinking_enabled"</span> <span class="hljs-attr">android:value</span>=<span class="hljs-string">"true"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">intent-filter</span> <span class="hljs-attr">android:autoVerify</span>=<span class="hljs-string">"true"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.intent.action.VIEW"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">category</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.intent.category.DEFAULT"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">category</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.intent.category.BROWSABLE"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">data</span> <span class="hljs-attr">android:scheme</span>=<span class="hljs-string">"https"</span> <span class="hljs-attr">android:host</span>=<span class="hljs-string">"su_dominio.com"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">intent-filter</span>&gt;</span>
</div></code></pre>
</li>
<li>
<p>Subir el fichero <em>.well-known/assetlinks.json</em> a su hosting web. Este archivo le dice al navegador móvil qué aplicación de Android abrir en lugar del navegador.</p>
<p>2.1 el fichero debe estar en la ruta <em>su_dominio.com/.well-known/assetlinks.json</em></p>
<pre class="hljs"><code><div>[{
<span class="hljs-attr">"relation"</span>: [<span class="hljs-string">"delegate_permission/common.handle_all_urls"</span>],
<span class="hljs-attr">"target"</span>: {
    <span class="hljs-attr">"namespace"</span>: <span class="hljs-string">"android_app"</span>,
    <span class="hljs-comment">// aplicationId</span>
    <span class="hljs-attr">"package_name"</span>: <span class="hljs-string">"com.example.app"</span>,
    <span class="hljs-attr">"sha256_cert_fingerprints"</span>:
    [<span class="hljs-string">"FF:2A:CF:7B:DD:CC:F1:03:3E:E8:B2:27:7C:A2:E3:3C:DE:13:DB:AC:8E:EB:3A:B9:72:A1:0E:26:8A:F5:EC:AF"</span>]
}
}]
</div></code></pre>
<p>2.2 Si ya está subida la app a producción puede localizar la configuración de este fichero en play.google.com/console y buscar <strong>Digital Asset Links JSON</strong></p>
<p>2.3 Si no está subida la app, debe crear su <a href="https://developer.android.com/studio/publish/app-signing?hl=es-419">clave de firma</a> sha256.</p>
</li>
<li>
<p>Para probar use el comando adb:</p>
<pre class="hljs"><code><div>adb shell <span class="hljs-string">'am start -a android.intent.action.VIEW \
 -c android.intent.category.BROWSABLE \
 -d "https://&lt;web-domain&gt;/details"'</span> \
 &lt;package name&gt;
</div></code></pre>
</li>
</ol>
<h3 id="ios">iOS</h3>
<ol>
<li>
<p>Agregar la clave <em>FlutterDeepLinkingEnabled</em> con valor true en el <strong>info.plist</strong>:</p>
<pre class="hljs"><code><div><span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>FlutterDeepLinkingEnabled<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">true</span>/&gt;</span>
</div></code></pre>
</li>
<li>
<p>Agregar su dominio web en el <strong>Runner.entitlements</strong>:</p>
<pre class="hljs"><code><div><span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>com.apple.developer.associated-domains<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">array</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>applinks:su_dominio.com<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">array</span>&gt;</span>
</div></code></pre>
</li>
<li>
<p>Subir el fichero <em>.well-known/apple-app-site-association</em> a su hosting web.</p>
<p>3.1 <em>Fichero sin extensión</em> debe estar en la ruta <em>su_dominio.com/.well-known/apple-app-site-association</em>:</p>
<pre class="hljs"><code><div>{
<span class="hljs-attr">"applinks"</span>: {
    <span class="hljs-attr">"apps"</span>: [],
    <span class="hljs-attr">"details"</span>: [
    {
        <span class="hljs-attr">"appID"</span>: <span class="hljs-string">"S8QB4VV633.com.surgschool.mobile.app"</span>,
        <span class="hljs-attr">"paths"</span>: [<span class="hljs-string">"*"</span>]
    }
    ]
}
}
</div></code></pre>
<ul>
<li><strong>appID</strong> es la combinación del <a href="https://developer.apple.com/account/resources/identifiers/list">team_id_apple</a>.bundle_id_apple</li>
<li><strong>[&quot;*&quot;]</strong>: Permite todas las rutas.</li>
</ul>
</li>
<li>
<p>Para probar use el comando:</p>
<pre class="hljs"><code><div>xcrun simctl openurl booted https://&lt;web domain&gt;/details
</div></code></pre>
</li>
</ol>
<h2 id="cloud-firestore">Cloud Firestore</h2>
<ul>
<li>
<p>Agregar la dependencia:</p>
<pre class="hljs"><code><div> flutter pub add cloud_firestore
</div></code></pre>
</li>
</ul>
<h3 id="escritura">Escritura</h3>
<ol>
<li>
<p>Inicializa una instancia de Cloud Firestore:</p>
<pre class="hljs"><code><div><span class="hljs-keyword">final</span> db = FirebaseFirestore.instance;
</div></code></pre>
</li>
<li>
<p>Crear o reemplazar. <strong>set()</strong>:</p>
<pre class="hljs"><code><div> <span class="hljs-keyword">final</span> city = &lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">String</span>&gt;{
 <span class="hljs-string">"name"</span>: <span class="hljs-string">"Los Angeles"</span>,
 <span class="hljs-string">"state"</span>: <span class="hljs-string">"CA"</span>,
 <span class="hljs-string">"country"</span>: <span class="hljs-string">"USA"</span>
 };

 db.collection(<span class="hljs-string">"cities"</span>)
 .doc(<span class="hljs-string">"LA"</span>)
 .<span class="hljs-keyword">set</span>(city)
 .onError((e, _) =&gt; <span class="hljs-built_in">print</span>(<span class="hljs-string">"Error writing document: <span class="hljs-subst">$e</span>"</span>));    
</div></code></pre>
<pre class="hljs"><code><div><span class="hljs-keyword">final</span> docData = {
<span class="hljs-string">"stringExample"</span>: <span class="hljs-string">"Hello world!"</span>,
<span class="hljs-string">"booleanExample"</span>: <span class="hljs-keyword">true</span>,
<span class="hljs-string">"numberExample"</span>: <span class="hljs-number">3.14159265</span>,
<span class="hljs-string">"dateExample"</span>: Timestamp.now(),
<span class="hljs-string">"listExample"</span>: [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>],
<span class="hljs-string">"nullExample"</span>: <span class="hljs-keyword">null</span>
};

<span class="hljs-keyword">final</span> nestedData = {
<span class="hljs-string">"a"</span>: <span class="hljs-number">5</span>,
<span class="hljs-string">"b"</span>: <span class="hljs-keyword">true</span>,
};

docData[<span class="hljs-string">"objectExample"</span>] = nestedData;

db.collection(<span class="hljs-string">"data"</span>)
.doc(<span class="hljs-string">"one"</span>)
.<span class="hljs-keyword">set</span>(docData)
.onError((e, _) =&gt; <span class="hljs-built_in">print</span>(<span class="hljs-string">"Error writing document: <span class="hljs-subst">$e</span>"</span>));  
</div></code></pre>
<p>2.1. Combinación de los datos. <strong>SetOptions()</strong>:</p>
<pre class="hljs"><code><div><span class="hljs-comment">// Update one field, creating the document if it does not already exist.</span>
<span class="hljs-keyword">final</span> data = {<span class="hljs-string">"capital"</span>: <span class="hljs-keyword">true</span>};

db.collection(<span class="hljs-string">"cities"</span>).doc(<span class="hljs-string">"BJ"</span>).<span class="hljs-keyword">set</span>(data, SetOptions(merge: <span class="hljs-keyword">true</span>));   
</div></code></pre>
</li>
<li>
<p>Agregar un documento:</p>
<pre class="hljs"><code><div><span class="hljs-comment">// Create a new user with a first and last name</span>
 <span class="hljs-keyword">final</span> user = &lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt;{
 <span class="hljs-string">"first"</span>: <span class="hljs-string">"Ada"</span>,
 <span class="hljs-string">"last"</span>: <span class="hljs-string">"Lovelace"</span>,
 <span class="hljs-string">"born"</span>: <span class="hljs-number">1815</span>
 };

 <span class="hljs-comment">// Add a new document with a generated ID</span>
 db.collection(<span class="hljs-string">"users"</span>).add(user).then((DocumentReference doc) =&gt; <span class="hljs-built_in">print</span>(<span class="hljs-string">'DocumentSnapshot added with ID: <span class="hljs-subst">${doc.id}</span>'</span>));
</div></code></pre>
</li>
<li>
<p>Escritura con Objetos personalizados (<strong>Map</strong> o <strong>Dictinary</strong>):</p>
<pre class="hljs"><code><div><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">City</span> </span>{
<span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span>? name;
<span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span>? state;
<span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span>? country;
<span class="hljs-keyword">final</span> <span class="hljs-built_in">bool</span>? capital;
<span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span>? population;
<span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;<span class="hljs-built_in">String</span>&gt;? regions;

City({
    <span class="hljs-keyword">this</span>.name,
    <span class="hljs-keyword">this</span>.state,
    <span class="hljs-keyword">this</span>.country,
    <span class="hljs-keyword">this</span>.capital,
    <span class="hljs-keyword">this</span>.population,
    <span class="hljs-keyword">this</span>.regions,
});

<span class="hljs-keyword">factory</span> City.fromFirestore(
    DocumentSnapshot&lt;<span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt;&gt; snapshot,
    SnapshotOptions? options,
) {
    <span class="hljs-keyword">final</span> data = snapshot.data();
    <span class="hljs-keyword">return</span> City(
    name: data?[<span class="hljs-string">'name'</span>],
    state: data?[<span class="hljs-string">'state'</span>],
    country: data?[<span class="hljs-string">'country'</span>],
    capital: data?[<span class="hljs-string">'capital'</span>],
    population: data?[<span class="hljs-string">'population'</span>],
    regions:
        data?[<span class="hljs-string">'regions'</span>] <span class="hljs-keyword">is</span> <span class="hljs-built_in">Iterable</span> ? <span class="hljs-built_in">List</span>.from(data?[<span class="hljs-string">'regions'</span>]) : <span class="hljs-keyword">null</span>,
    );
}

<span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; toFirestore() {
    <span class="hljs-keyword">return</span> {
    <span class="hljs-keyword">if</span> (name != <span class="hljs-keyword">null</span>) <span class="hljs-string">"name"</span>: name,
    <span class="hljs-keyword">if</span> (state != <span class="hljs-keyword">null</span>) <span class="hljs-string">"state"</span>: state,
    <span class="hljs-keyword">if</span> (country != <span class="hljs-keyword">null</span>) <span class="hljs-string">"country"</span>: country,
    <span class="hljs-keyword">if</span> (capital != <span class="hljs-keyword">null</span>) <span class="hljs-string">"capital"</span>: capital,
    <span class="hljs-keyword">if</span> (population != <span class="hljs-keyword">null</span>) <span class="hljs-string">"population"</span>: population,
    <span class="hljs-keyword">if</span> (regions != <span class="hljs-keyword">null</span>) <span class="hljs-string">"regions"</span>: regions,
    };
}
}
</div></code></pre>
<pre class="hljs"><code><div><span class="hljs-keyword">final</span> city = City(
name: <span class="hljs-string">"Los Angeles"</span>,
state: <span class="hljs-string">"CA"</span>,
country: <span class="hljs-string">"USA"</span>,
capital: <span class="hljs-keyword">false</span>,
population: <span class="hljs-number">5000000</span>,
regions: [<span class="hljs-string">"west_coast"</span>, <span class="hljs-string">"socal"</span>],
);
<span class="hljs-keyword">final</span> docRef = db
    .collection(<span class="hljs-string">"cities"</span>)
    .withConverter(
    fromFirestore: City.fromFirestore,
    toFirestore: (City city, options) =&gt; city.toFirestore(),
    )
    .doc(<span class="hljs-string">"LA"</span>);
<span class="hljs-keyword">await</span> docRef.<span class="hljs-keyword">set</span>(city);
</div></code></pre>
</li>
<li>
<p>Actualizar datos:</p>
<pre class="hljs"><code><div> <span class="hljs-keyword">final</span> washingtonRef = db.collection(<span class="hljs-string">"cites"</span>).doc(<span class="hljs-string">"DC"</span>);
 washingtonRef
 .update({<span class="hljs-string">"capital"</span>: <span class="hljs-keyword">true</span>})
 .then((value) =&gt; <span class="hljs-built_in">print</span>(<span class="hljs-string">"DocumentSnapshot successfully updated!"</span>),
     onError: (e) =&gt; <span class="hljs-built_in">print</span>(<span class="hljs-string">"Error updating document <span class="hljs-subst">$e</span>"</span>));
</div></code></pre>
<ul>
<li>Actualiza los campos en objetos anidados. Usando . es más optimo.</li>
</ul>
<pre class="hljs"><code><div> <span class="hljs-comment">// Assume the document contains:</span>
 <span class="hljs-comment">// {</span>
 <span class="hljs-comment">//   name: "Frank",</span>
 <span class="hljs-comment">//   favorites: { food: "Pizza", color: "Blue", subject: "recess" }</span>
 <span class="hljs-comment">//   age: 12</span>
 <span class="hljs-comment">// }</span>
 db.collection(<span class="hljs-string">"users"</span>)
     .doc(<span class="hljs-string">"frank"</span>)
     .update({<span class="hljs-string">"age"</span>: <span class="hljs-number">13</span>, <span class="hljs-string">"favorites.color"</span>: <span class="hljs-string">"Red"</span>});
</div></code></pre>
<ul>
<li>Actualizar elementos de un array. <strong>arrayUnion()</strong>, <strong>arrayRemove()</strong></li>
</ul>
<pre class="hljs"><code><div><span class="hljs-keyword">final</span> washingtonRef = db.collection(<span class="hljs-string">"cities"</span>).doc(<span class="hljs-string">"DC"</span>);

 <span class="hljs-comment">// Atomically add a new region to the "regions" array field.</span>
 washingtonRef.update({
 <span class="hljs-string">"regions"</span>: FieldValue.arrayUnion([<span class="hljs-string">"greater_virginia"</span>]),
 });

 <span class="hljs-comment">// Atomically remove a region from the "regions" array field.</span>
 washingtonRef.update({
 <span class="hljs-string">"regions"</span>: FieldValue.arrayRemove([<span class="hljs-string">"east_coast"</span>]),
 });
</div></code></pre>
<ul>
<li>Actualizar Incremetar. <strong>increment(value)</strong></li>
</ul>
<pre class="hljs"><code><div> <span class="hljs-keyword">var</span> washingtonRef = db.collection(<span class="hljs-string">'cities'</span>).doc(<span class="hljs-string">'DC'</span>);

 <span class="hljs-comment">// Atomically increment the population of the city by 50.</span>
 washingtonRef.update(
 {<span class="hljs-string">"population"</span>: FieldValue.increment(<span class="hljs-number">50</span>)},
 );
</div></code></pre>
</li>
</ol>
<h4 id="transacciones">Transacciones</h4>
<pre class="hljs"><code><div><span class="hljs-comment">// lectura deben ejecutarse siempre antes de cualquier operación </span>
 <span class="hljs-keyword">final</span> sfDocRef = db.collection(<span class="hljs-string">"cities"</span>).doc(<span class="hljs-string">"SF"</span>);
 db.runTransaction((transaction) <span class="hljs-keyword">async</span> {
 <span class="hljs-keyword">final</span> snapshot = <span class="hljs-keyword">await</span> transaction.<span class="hljs-keyword">get</span>(sfDocRef);
 <span class="hljs-comment">// Note: this could be done without a transaction</span>
 <span class="hljs-comment">//       by updating the population using FieldValue.increment()</span>
 <span class="hljs-keyword">final</span> newPopulation = snapshot.<span class="hljs-keyword">get</span>(<span class="hljs-string">"population"</span>) + <span class="hljs-number">1</span>;
 transaction.update(sfDocRef, {<span class="hljs-string">"population"</span>: newPopulation});
 }).then(
 (value) =&gt; <span class="hljs-built_in">print</span>(<span class="hljs-string">"DocumentSnapshot successfully updated!"</span>),
 onError: (e) =&gt; <span class="hljs-built_in">print</span>(<span class="hljs-string">"Error updating document <span class="hljs-subst">$e</span>"</span>),
 );
</div></code></pre>
<ul>
<li>Pasar información fuera la transacción.</li>
</ul>
<p>No modifiques el estado de la aplicación dentro de las funciones de transacción. Si lo haces, es posible que se generen problemas de simultaneidad debido a que las funciones de transacción pueden ejecutarse varias veces y no se garantiza que se ejecuten en el subproceso de IU.</p>
<pre class="hljs"><code><div> <span class="hljs-keyword">final</span> sfDocRef = db.collection(<span class="hljs-string">"cities"</span>).doc(<span class="hljs-string">"SF"</span>);
 db.runTransaction((transaction) {
 <span class="hljs-keyword">return</span> transaction.<span class="hljs-keyword">get</span>(sfDocRef).then((sfDoc) {
     <span class="hljs-keyword">final</span> newPopulation = sfDoc.<span class="hljs-keyword">get</span>(<span class="hljs-string">"population"</span>) + <span class="hljs-number">1</span>;
     transaction.update(sfDocRef, {<span class="hljs-string">"population"</span>: newPopulation});
     <span class="hljs-keyword">return</span> newPopulation;
 });
 }).then(
 (newPopulation) =&gt; <span class="hljs-built_in">print</span>(<span class="hljs-string">"Population increased to <span class="hljs-subst">$newPopulation</span>"</span>),
 onError: (e) =&gt; <span class="hljs-built_in">print</span>(<span class="hljs-string">"Error updating document <span class="hljs-subst">$e</span>"</span>),
 );
</div></code></pre>
<h4 id="escrituras-en-lotes-m%C3%BAltiples-operaciones">Escrituras en lotes. Múltiples operaciones</h4>
<pre class="hljs"><code><div><span class="hljs-comment">// Get a new write batch</span>
<span class="hljs-keyword">final</span> batch = db.batch();

<span class="hljs-comment">// Set the value of 'NYC'</span>
<span class="hljs-keyword">var</span> nycRef = db.collection(<span class="hljs-string">"cities"</span>).doc(<span class="hljs-string">"NYC"</span>);
batch.<span class="hljs-keyword">set</span>(nycRef, {<span class="hljs-string">"name"</span>: <span class="hljs-string">"New York City"</span>});

<span class="hljs-comment">// Update the population of 'SF'</span>
<span class="hljs-keyword">var</span> sfRef = db.collection(<span class="hljs-string">"cities"</span>).doc(<span class="hljs-string">"SF"</span>);
batch.update(sfRef, {<span class="hljs-string">"population"</span>: <span class="hljs-number">1000000</span>});

<span class="hljs-comment">// Delete the city 'LA'</span>
<span class="hljs-keyword">var</span> laRef = db.collection(<span class="hljs-string">"cities"</span>).doc(<span class="hljs-string">"LA"</span>);
batch.delete(laRef);

<span class="hljs-comment">// Commit the batch</span>
batch.commit().then((_) {
<span class="hljs-comment">// ...</span>
});
</div></code></pre>
<h3 id="borrado">Borrado</h3>
<ol>
<li>
<p><strong>delete()</strong>:</p>
<pre class="hljs"><code><div> db.collection(<span class="hljs-string">"cities"</span>).doc(<span class="hljs-string">"DC"</span>).delete().then(
     (doc) =&gt; <span class="hljs-built_in">print</span>(<span class="hljs-string">"Document deleted"</span>),
     onError: (e) =&gt; <span class="hljs-built_in">print</span>(<span class="hljs-string">"Error updating document <span class="hljs-subst">$e</span>"</span>),
     );
</div></code></pre>
</li>
<li>
<p>Borrar campos</p>
<pre class="hljs"><code><div><span class="hljs-keyword">final</span> docRef = db.collection(<span class="hljs-string">"cities"</span>).doc(<span class="hljs-string">"BJ"</span>);

<span class="hljs-comment">// Remove the 'capital' field from the document</span>
<span class="hljs-keyword">final</span> updates = &lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt;{
<span class="hljs-string">"capital"</span>: FieldValue.delete(),
};

docRef.update(updates);
</div></code></pre>
</li>
<li>
<p>Borrar colecciones</p>
<p>Si borras un documento, no se borrarán las subcolecciones que contiene.</p>
<p>Para borrar por completo una colección o subcolección en Cloud Firestore, recupera (lee) todos los documentos de la colección o subcolección y bórralos. Este proceso genera costos de lectura y eliminación. Si tienes colecciones más grandes, te recomendamos borrar los documentos en lotes pequeños para evitar errores de memoria insuficiente. Repite el proceso hasta que borres toda la colección o subcolección.</p>
<p>No se recomienda borrar colecciones desde el cliente.</p>
</li>
</ol>
<h3 id="lectura">Lectura</h3>
<ol>
<li>
<p>Leer datos:</p>
<pre class="hljs"><code><div> <span class="hljs-keyword">final</span> docRef = db.collection(<span class="hljs-string">"cities"</span>).doc(<span class="hljs-string">"SF"</span>);
 docRef.<span class="hljs-keyword">get</span>().then(
 (DocumentSnapshot doc) {
     <span class="hljs-keyword">final</span> data = doc.data() <span class="hljs-keyword">as</span> <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt;;
     <span class="hljs-comment">// ...</span>
 },
 onError: (e) =&gt; <span class="hljs-built_in">print</span>(<span class="hljs-string">"Error getting document: <span class="hljs-subst">$e</span>"</span>),
 );
</div></code></pre>
<ul>
<li>Datos en caché</li>
</ul>
<pre class="hljs"><code><div> <span class="hljs-keyword">final</span> docRef = db.collection(<span class="hljs-string">"cities"</span>).doc(<span class="hljs-string">"SF"</span>);

 <span class="hljs-comment">// Source can be CACHE, SERVER, or DEFAULT.</span>
 <span class="hljs-keyword">const</span> source = Source.cache;

 docRef.<span class="hljs-keyword">get</span>(<span class="hljs-keyword">const</span> GetOptions(source: source)).then(
     (res) =&gt; <span class="hljs-built_in">print</span>(<span class="hljs-string">"Successfully completed"</span>),
     onError: (e) =&gt; <span class="hljs-built_in">print</span>(<span class="hljs-string">"Error completing: <span class="hljs-subst">$e</span>"</span>),
     );
</div></code></pre>
<ul>
<li>Lectura con Objetos personalizados (<strong>Map</strong> o <strong>Dictinary</strong>):</li>
</ul>
<pre class="hljs"><code><div> <span class="hljs-keyword">final</span> ref = db.collection(<span class="hljs-string">"cities"</span>).doc(<span class="hljs-string">"LA"</span>).withConverter(
     fromFirestore: City.fromFirestore,
     toFirestore: (City city, _) =&gt; city.toFirestore(),
     );
 <span class="hljs-keyword">final</span> docSnap = <span class="hljs-keyword">await</span> ref.<span class="hljs-keyword">get</span>();
 <span class="hljs-keyword">final</span> city = docSnap.data(); <span class="hljs-comment">// Convert to City object</span>
 <span class="hljs-keyword">if</span> (city != <span class="hljs-keyword">null</span>) {
     <span class="hljs-built_in">print</span>(city);
 } <span class="hljs-keyword">else</span> {
     <span class="hljs-built_in">print</span>(<span class="hljs-string">"No such document."</span>);
 }
</div></code></pre>
<ul>
<li>Iterar colecciones</li>
</ul>
<pre class="hljs"><code><div> <span class="hljs-keyword">await</span> db.collection(<span class="hljs-string">"users"</span>).<span class="hljs-keyword">get</span>().then((event) {
 <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> doc <span class="hljs-keyword">in</span> event.docs) {
     <span class="hljs-built_in">print</span>(<span class="hljs-string">"<span class="hljs-subst">${doc.id}</span> =&gt; <span class="hljs-subst">${doc.data()}</span>"</span>);
 }
 });
</div></code></pre>
<ul>
<li>Filtrado (<strong>where</strong>):</li>
</ul>
<pre class="hljs"><code><div> db.collection(<span class="hljs-string">"cities"</span>).where(<span class="hljs-string">"capital"</span>, isEqualTo: <span class="hljs-keyword">true</span>).<span class="hljs-keyword">get</span>().then(
 (querySnapshot) {
     <span class="hljs-built_in">print</span>(<span class="hljs-string">"Successfully completed"</span>);
     <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> docSnapshot <span class="hljs-keyword">in</span> querySnapshot.docs) {
     <span class="hljs-built_in">print</span>(<span class="hljs-string">'<span class="hljs-subst">${docSnapshot.id}</span> =&gt; <span class="hljs-subst">${docSnapshot.data()}</span>'</span>);
     }
 },
 onError: (e) =&gt; <span class="hljs-built_in">print</span>(<span class="hljs-string">"Error completing: <span class="hljs-subst">$e</span>"</span>),
 );
</div></code></pre>
<ul>
<li>Subcolecciones:</li>
</ul>
<pre class="hljs"><code><div> db.collection(<span class="hljs-string">"cities"</span>).doc(<span class="hljs-string">"SF"</span>).collection(<span class="hljs-string">"landmarks"</span>).<span class="hljs-keyword">get</span>().then(
 (querySnapshot) {
     <span class="hljs-built_in">print</span>(<span class="hljs-string">"Successfully completed"</span>);
     <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> docSnapshot <span class="hljs-keyword">in</span> querySnapshot.docs) {
     <span class="hljs-built_in">print</span>(<span class="hljs-string">'<span class="hljs-subst">${docSnapshot.id}</span> =&gt; <span class="hljs-subst">${docSnapshot.data()}</span>'</span>);
     }
 },
 onError: (e) =&gt; <span class="hljs-built_in">print</span>(<span class="hljs-string">"Error completing: <span class="hljs-subst">$e</span>"</span>),
 );
</div></code></pre>
</li>
</ol>
<h4 id="lectura-en-timpo-real-stream-streambuilder-listen">Lectura en timpo real. <strong>Stream</strong>, <strong>StreamBuilder</strong>, <strong>listen</strong></h4>
<pre class="hljs"><code><div>  <span class="hljs-keyword">final</span> docRef = db.collection(<span class="hljs-string">"cities"</span>).doc(<span class="hljs-string">"SF"</span>);
  docRef.snapshots()
  .listen((event) =&gt; <span class="hljs-built_in">print</span>(<span class="hljs-string">"current data: <span class="hljs-subst">${event.data()}</span>"</span>),
  onError:(error) =&gt; <span class="hljs-built_in">print</span>(<span class="hljs-string">"Listen failed: <span class="hljs-subst">$error</span>"</span>),
  );
</div></code></pre>
<ul>
<li>
<p>En la UI</p>
<pre class="hljs"><code><div> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserInformation</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>{
 <span class="hljs-meta">@override</span>
 _UserInformationState createState() =&gt; _UserInformationState();
 }

 <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_UserInformationState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">UserInformation</span>&gt; </span>{
 <span class="hljs-keyword">final</span> Stream&lt;QuerySnapshot&gt; _usersStream =
     FirebaseFirestore.instance.collection(<span class="hljs-string">'users'</span>).snapshots();

 <span class="hljs-meta">@override</span>
 Widget build(BuildContext context) {
     <span class="hljs-keyword">return</span> StreamBuilder&lt;QuerySnapshot&gt;(
     stream: _usersStream,
     builder: (BuildContext context, AsyncSnapshot&lt;QuerySnapshot&gt; snapshot) {
         <span class="hljs-keyword">if</span> (snapshot.hasError) {
         <span class="hljs-keyword">return</span> <span class="hljs-keyword">const</span> Text(<span class="hljs-string">'Something went wrong'</span>);
         }

         <span class="hljs-keyword">if</span> (snapshot.connectionState == ConnectionState.waiting) {
         <span class="hljs-keyword">return</span> <span class="hljs-keyword">const</span> Text(<span class="hljs-string">"Loading"</span>);
         }

         <span class="hljs-keyword">return</span> ListView(
         children: snapshot.data!.docs
             .map((DocumentSnapshot <span class="hljs-built_in">document</span>) {
                 <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; data =
                     <span class="hljs-built_in">document</span>.data()! <span class="hljs-keyword">as</span> <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt;;
                 <span class="hljs-keyword">return</span> ListTile(
                 title: Text(data[<span class="hljs-string">'full_name'</span>]),
                 subtitle: Text(data[<span class="hljs-string">'company'</span>]),
                 );
             })
             .toList()
             .cast(),
         );
     },
     );
 }
 }
</div></code></pre>
</li>
<li>
<p>Escuchar varios documentos en una colección</p>
<pre class="hljs"><code><div>db
    .collection(<span class="hljs-string">"cities"</span>)
    .where(<span class="hljs-string">"state"</span>, isEqualTo: <span class="hljs-string">"CA"</span>)
    .snapshots()
    .listen((event) {
<span class="hljs-keyword">final</span> cities = [];
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> doc <span class="hljs-keyword">in</span> event.docs) {
    cities.add(doc.data()[<span class="hljs-string">"name"</span>]);
}
<span class="hljs-built_in">print</span>(<span class="hljs-string">"cities in CA: <span class="hljs-subst">${cities.join(<span class="hljs-string">", "</span>)}</span>"</span>);
});
</div></code></pre>
</li>
<li>
<p>Escuchar modificaciones individuales</p>
<pre class="hljs"><code><div>db
    .collection(<span class="hljs-string">"cities"</span>)
    .where(<span class="hljs-string">"state"</span>, isEqualTo: <span class="hljs-string">"CA"</span>)
    .snapshots()
    .listen((event) {
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> change <span class="hljs-keyword">in</span> event.docChanges) {
    <span class="hljs-keyword">switch</span> (change.type) {
    <span class="hljs-keyword">case</span> DocumentChangeType.added:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"New City: <span class="hljs-subst">${change.doc.data()}</span>"</span>);
        <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> DocumentChangeType.modified:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"Modified City: <span class="hljs-subst">${change.doc.data()}</span>"</span>);
        <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> DocumentChangeType.removed:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"Removed City: <span class="hljs-subst">${change.doc.data()}</span>"</span>);
        <span class="hljs-keyword">break</span>;
    }
}
});
</div></code></pre>
</li>
<li>
<p>Cancelar la escucha</p>
<pre class="hljs"><code><div><span class="hljs-keyword">final</span> collection = db.collection(<span class="hljs-string">"cities"</span>);
<span class="hljs-keyword">final</span> listener = collection.snapshots().listen((event) {
<span class="hljs-comment">// ...</span>
});
listener.cancel();
</div></code></pre>
</li>
<li>
<p>Uso de <strong>where()</strong>
El método where() usa tres parámetros: un campo para filtrar, una operación de comparación y un valor. Cloud Firestore admite los siguientes operadores de comparación:</p>
<ul>
<li>
<p>&lt; menor que</p>
</li>
<li>
<p>&lt;= menor o igual que</p>
</li>
<li>
<p>== igual que</p>
</li>
<li>
<blockquote>
<p>mayor que</p>
</blockquote>
</li>
<li>
<blockquote>
<p>= mayor que o igual que</p>
</blockquote>
</li>
<li>
<p>!= no igual a</p>
</li>
<li>
<p>array-contains</p>
</li>
<li>
<p>array-contains-any</p>
</li>
<li>
<p>in</p>
</li>
<li>
<p>not-in</p>
<pre class="hljs"><code><div><span class="hljs-keyword">final</span> citiesRef = db.collection(<span class="hljs-string">"cities"</span>);

<span class="hljs-keyword">final</span> stateQuery = citiesRef.where(<span class="hljs-string">"state"</span>, isEqualTo: <span class="hljs-string">"CA"</span>);
<span class="hljs-keyword">final</span> nameQuery = citiesRef.where(<span class="hljs-string">"name"</span>, isEqualTo: <span class="hljs-string">"San Francisco"</span>);
<span class="hljs-keyword">final</span> notCapitals = citiesRef.where(<span class="hljs-string">"capital"</span>, isNotEqualTo: <span class="hljs-keyword">true</span>);

<span class="hljs-keyword">final</span> populationQuery = citiesRef.where(<span class="hljs-string">"population"</span>, isLessThan: <span class="hljs-number">100000</span>);

<span class="hljs-keyword">final</span> westCoastcities = citiesRef.where(<span class="hljs-string">"regions"</span>, arrayContains: <span class="hljs-string">"west_coast"</span>);

<span class="hljs-comment">// el campo coincide con cualquiera de los valores</span>
<span class="hljs-keyword">final</span> cities = citiesRef.where(<span class="hljs-string">"country"</span>, whereIn: [<span class="hljs-string">"USA"</span>, <span class="hljs-string">"Japan"</span>]);
<span class="hljs-comment">// no coincide con ninguno de los valores de comparación</span>
<span class="hljs-keyword">final</span> cities = citiesRef.where(<span class="hljs-string">"country"</span>, whereNotIn: [<span class="hljs-string">"USA"</span>, <span class="hljs-string">"Japan"</span>]);

<span class="hljs-keyword">final</span> cities = citiesRef.where(<span class="hljs-string">"regions"</span>, arrayContainsAny: [<span class="hljs-string">"west_coast"</span>, <span class="hljs-string">"east_coast"</span>]);
</div></code></pre>
</li>
</ul>
</li>
<li>
<p>Encadenar múltiples operadores</p>
<pre class="hljs"><code><div>citiesRef
    .where(<span class="hljs-string">"state"</span>, isEqualTo: <span class="hljs-string">"CO"</span>)
    .where(<span class="hljs-string">"name"</span>, isEqualTo: <span class="hljs-string">"Denver"</span>);

citiesRef
    .where(<span class="hljs-string">"state"</span>, isEqualTo: <span class="hljs-string">"CA"</span>)
    .where(<span class="hljs-string">"population"</span>, isLessThan: <span class="hljs-number">1000000</span>);

citiesRef
    .where(<span class="hljs-string">"state"</span>, isGreaterThanOrEqualTo: <span class="hljs-string">"CA"</span>)
    .where(<span class="hljs-string">"state"</span>, isLessThanOrEqualTo: <span class="hljs-string">"IN"</span>);
citiesRef
    .where(<span class="hljs-string">"state"</span>, isEqualTo: <span class="hljs-string">"CA"</span>)
    .where(<span class="hljs-string">"population"</span>, isGreaterThan: <span class="hljs-number">1000000</span>);
</div></code></pre>
</li>
<li>
<p>Consultas combinadas</p>
<pre class="hljs"><code><div><span class="hljs-keyword">var</span> query = db.collection(<span class="hljs-string">"cities"</span>)
    .where(
        Filter.or(
        Filter(<span class="hljs-string">"capital"</span>, isEqualTo: <span class="hljs-keyword">true</span>),
        Filter(<span class="hljs-string">"population"</span>, isGreaterThan: <span class="hljs-number">1000000</span>)
        ));

<span class="hljs-keyword">var</span> query = db.collection(<span class="hljs-string">"cities"</span>)
    .where(
    Filter.and(
        Filter(<span class="hljs-string">"state"</span>, isEqualTo: <span class="hljs-string">"CA"</span>),
    Filter.or(
        Filter(<span class="hljs-string">"capital"</span>, isEqualTo: <span class="hljs-keyword">true</span>),
        Filter(<span class="hljs-string">"population"</span>, isGreaterThan: <span class="hljs-number">1000000</span>)
    )));
</div></code></pre>
</li>
<li>
<p>Consultas de grupo</p>
<pre class="hljs"><code><div><span class="hljs-keyword">final</span> citiesRef = db.collection(<span class="hljs-string">"cities"</span>);

<span class="hljs-keyword">final</span> ggbData = {<span class="hljs-string">"name"</span>: <span class="hljs-string">"Golden Gate Bridge"</span>, <span class="hljs-string">"type"</span>: <span class="hljs-string">"bridge"</span>};
citiesRef.doc(<span class="hljs-string">"SF"</span>).collection(<span class="hljs-string">"landmarks"</span>).add(ggbData);

<span class="hljs-keyword">final</span> lohData = {<span class="hljs-string">"name"</span>: <span class="hljs-string">"Legion of Honor"</span>, <span class="hljs-string">"type"</span>: <span class="hljs-string">"museum"</span>};
citiesRef.doc(<span class="hljs-string">"SF"</span>).collection(<span class="hljs-string">"landmarks"</span>).add(lohData);

db
    .collectionGroup(<span class="hljs-string">"landmarks"</span>)
    .where(<span class="hljs-string">"type"</span>, isEqualTo: <span class="hljs-string">"museum"</span>)
    .<span class="hljs-keyword">get</span>()
    .then(
    (res) =&gt; <span class="hljs-built_in">print</span>(<span class="hljs-string">"Successfully completed"</span>),
    onError: (e) =&gt; <span class="hljs-built_in">print</span>(<span class="hljs-string">"Error completing: <span class="hljs-subst">$e</span>"</span>),
    );
</div></code></pre>
<p>Antes de usar una consulta de grupos de colecciones, debes crear un índice que la admita. <a href="https://firebase.google.com/docs/firestore/query-data/indexing?hl=es-419">Puedes crear un índice mediante un mensaje de error, la consola o Firebase CLI</a>.</p>
</li>
</ul>
<h4 id="orden-orderby-y-l%C3%ADmite-limit">Orden <strong>orderBy()</strong> y límite <strong>limit()</strong></h4>
<pre class="hljs"><code><div>    <span class="hljs-keyword">final</span> citiesRef = db.collection(<span class="hljs-string">"cities"</span>);
    citiesRef.orderBy(<span class="hljs-string">"name"</span>).limit(<span class="hljs-number">3</span>);

    <span class="hljs-comment">// descendente</span>
    citiesRef.orderBy(<span class="hljs-string">"name"</span>, descending: <span class="hljs-keyword">true</span>).limit(<span class="hljs-number">3</span>);

    citiesRef
        .where(<span class="hljs-string">"population"</span>, isGreaterThan: <span class="hljs-number">100000</span>)
        .orderBy(<span class="hljs-string">"population"</span>)
        .limit(<span class="hljs-number">2</span>);

    <span class="hljs-comment">// no válido</span>
    citiesRef.where(<span class="hljs-string">"population"</span>, isGreaterThan: <span class="hljs-number">100000</span>).orderBy(<span class="hljs-string">"country"</span>);
</div></code></pre>
<h4 id="paginar-datos-con-cursores-startat-startafterendat-endbefore">Paginar datos con cursores <strong>startAt()</strong>, <strong>startAfter()</strong>,<strong>endAt()</strong>, <strong>endBefore()</strong></h4>
<pre class="hljs"><code><div><span class="hljs-comment">// startAt(A) -&gt; A-Z</span>
<span class="hljs-comment">// startAfter(A) -&gt; B-Z</span>
db.collection(<span class="hljs-string">"cities"</span>).orderBy(<span class="hljs-string">"population"</span>).startAt([<span class="hljs-number">1000000</span>]);
db.collection(<span class="hljs-string">"cities"</span>).orderBy(<span class="hljs-string">"population"</span>).endAt([<span class="hljs-number">1000000</span>]);
</div></code></pre>
<ul>
<li>
<p>Documento para definir el cursor de consulta</p>
<pre class="hljs"><code><div><span class="hljs-comment">// todas las ciudades con una población mayor o igual que la de San Francisco</span>
db.collection(<span class="hljs-string">"cities"</span>).doc(<span class="hljs-string">"SF"</span>).<span class="hljs-keyword">get</span>().then(
(documentSnapshot) {
    <span class="hljs-keyword">final</span> biggerThanSf = db
        .collection(<span class="hljs-string">"cities"</span>)
        .orderBy(<span class="hljs-string">"population"</span>)
        .startAtDocument(documentSnapshot);
},
onError: (e) =&gt; <span class="hljs-built_in">print</span>(<span class="hljs-string">"Error: <span class="hljs-subst">$e</span>"</span>),
);
</div></code></pre>
</li>
<li>
<p>Paginar una consulta. Combina cursores de consulta con el método limit().</p>
<pre class="hljs"><code><div><span class="hljs-comment">// Construct query for first 25 cities, ordered by population</span>
<span class="hljs-keyword">final</span> first = db.collection(<span class="hljs-string">"cities"</span>).orderBy(<span class="hljs-string">"population"</span>).limit(<span class="hljs-number">25</span>);

first.<span class="hljs-keyword">get</span>().then(
(documentSnapshots) {
    <span class="hljs-comment">// Get the last visible document</span>
    <span class="hljs-keyword">final</span> lastVisible = documentSnapshots.docs[documentSnapshots.size - <span class="hljs-number">1</span>];

    <span class="hljs-comment">// Construct a new query starting at this document,</span>
    <span class="hljs-comment">// get the next 25 cities.</span>
    <span class="hljs-keyword">final</span> next = db
        .collection(<span class="hljs-string">"cities"</span>)
        .orderBy(<span class="hljs-string">"population"</span>)
        .startAfterDocument(lastVisible).limit(<span class="hljs-number">25</span>);

    <span class="hljs-comment">// Use the query for pagination</span>
    <span class="hljs-comment">// ...</span>
},
onError: (e) =&gt; <span class="hljs-built_in">print</span>(<span class="hljs-string">"Error completing: <span class="hljs-subst">$e</span>"</span>),
);
</div></code></pre>
</li>
<li>
<p>Cursor en función de varios campos.</p>
<pre class="hljs"><code><div><span class="hljs-comment">/*
*       Ciudades
* Nombre        Estado
* Springfield   Massachusetts
* Springfield   Missouri
* Springfield   Wisconsin
*/</span>

<span class="hljs-comment">// Will return all Springfields</span>
db
    .collection(<span class="hljs-string">"cities"</span>)
    .orderBy(<span class="hljs-string">"name"</span>)
    .orderBy(<span class="hljs-string">"state"</span>)
    .startAt([<span class="hljs-string">"Springfield"</span>]);

<span class="hljs-comment">// Will return "Springfield, Missouri" and "Springfield, Wisconsin"</span>
db
    .collection(<span class="hljs-string">"cities"</span>)
    .orderBy(<span class="hljs-string">"name"</span>)
    .orderBy(<span class="hljs-string">"state"</span>)
    .startAt([<span class="hljs-string">"Springfield"</span>, <span class="hljs-string">"Missouri"</span>]);
</div></code></pre>
</li>
</ul>
<h4 id="datos-sin-conexi%C3%B3n">Datos sin conexión</h4>
<p>En las plataformas de Android y Apple, la persistencia sin conexión está habilitada de forma predeterminada. En la Web, la persistencia sin conexión está inhabilitada de forma predeterminada.</p>
<pre class="hljs"><code><div><span class="hljs-comment">// Apple and Android</span>
db.settings = <span class="hljs-keyword">const</span> Settings(persistenceEnabled: <span class="hljs-keyword">true</span>);

<span class="hljs-comment">// Web</span>
<span class="hljs-keyword">await</span> db
    .enablePersistence(<span class="hljs-keyword">const</span> PersistenceSettings(synchronizeTabs: <span class="hljs-keyword">true</span>));
</div></code></pre>
<ul>
<li>
<p>Tamaño de la caché</p>
<pre class="hljs"><code><div>db.settings = <span class="hljs-keyword">const</span> Settings(
persistenceEnabled: <span class="hljs-keyword">true</span>,
cacheSizeBytes: Settings.CACHE_SIZE_UNLIMITED,
);
</div></code></pre>
</li>
<li>
<p>Esucha sin conexión</p>
<pre class="hljs"><code><div>db
    .collection(<span class="hljs-string">"cities"</span>)
    .where(<span class="hljs-string">"state"</span>, isEqualTo: <span class="hljs-string">"CA"</span>)
    .snapshots(includeMetadataChanges: <span class="hljs-keyword">true</span>)
    .listen((querySnapshot) {
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> change <span class="hljs-keyword">in</span> querySnapshot.docChanges) {
    <span class="hljs-keyword">if</span> (change.type == DocumentChangeType.added) {
    <span class="hljs-keyword">final</span> source =
        (querySnapshot.metadata.isFromCache) ? <span class="hljs-string">"local cache"</span> : <span class="hljs-string">"server"</span>;

    <span class="hljs-built_in">print</span>(<span class="hljs-string">"Data fetched from <span class="hljs-subst">$source</span>}"</span>);
    }
}
});
</div></code></pre>
</li>
</ul>
<ol>
<li>
<p><a href="https://firebase.google.com/docs/firestore/quickstart?hl=es-419#secure_your_data">Protege los datos</a></p>
</li>
<li>
<p>Referencias:</p>
<pre class="hljs"><code><div><span class="hljs-keyword">final</span> myDocumentRef = db.collection(<span class="hljs-string">"users"</span>).doc(<span class="hljs-string">"id_name"</span>);

<span class="hljs-keyword">final</span> myDocumentRef = db.collection(<span class="hljs-string">"users/id_name"</span>);
</div></code></pre>
<ul>
<li>Subcolección:</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-keyword">final</span> messageRef = db
    .collection(<span class="hljs-string">"rooms"</span>)
    .doc(<span class="hljs-string">"roomA"</span>)
    .collection(<span class="hljs-string">"messages"</span>);
</div></code></pre>
</li>
</ol>

</body>
</html>
